## åŸºç¡€è«é˜Ÿ

> ç»™ä¸€ä¸ªé•¿åº¦ä¸º `n` çš„åºåˆ—ã€‚`q` ä¸ªè¯¢é—®ã€‚
> é—®åŒºé—´ `(l,r)` ä¸­é€‰ä¸¤ä¸ªæ•°ï¼Œé€‰åˆ°ç›¸åŒæ•°å­—çš„æ¦‚ç‡æ˜¯å¤šå°‘ã€‚
> n,qèŒƒå›´åˆ° `5e4`ã€‚


```cpp

const int N = 5e4 + 100;
int c[N];
int n,q;
int ans[N];
int ans2[N];
int cnt[N];
int tmp;
array<int,3> que[N];

void solve()
{
   cin >> n >> q;
   for(int i = 1;i <= n;i ++) cin >> c[i];
   for(int i = 0;i < q; i ++){
    int l,r; cin >> l >> r;
    que[i] = {l,r,i};
    ans2[i] = (r - l) * (r - l + 1) / 2;
   }

   int B = 500;
   sort(que, que + q, [&](array<int,3> a, array<int,3> b){
    if(a[0]/B != b[0]/B ) return a[0]/B < b[0]/B;
    return a[1]< b[1];
   }  );

   int l = 1; int r = 0;

   auto add = [&](int x){
    tmp += cnt[c[x]];
    cnt[c[x]] ++;
   };

   auto del = [&](int x){
    cnt[c[x]] --;
    tmp -= cnt[c[x]];
   };

   for(int i = 0;i < q;i ++){
    while(r < que[i][1]) r ++, add(r);
    while(l > que[i][0]) l --, add(l);
    while(r > que[i][1]) del(r), r --;
    while(l < que[i][0]) del(l), l ++;
    ans[que[i][2]] = tmp;
   }

   for(int i = 0;i < q;i ++)
   {
     int d = gcd(ans[i],ans2[i]);
     
     cout << ans[i]/d << '/' << ans2[i]/d << endl;
   }
}

```


## å›æ»šè«é˜Ÿ
> ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º`ğ‘›`çš„åºåˆ—ï¼Œç¦»çº¿è¯¢é—®`ğ‘š`ä¸ªé—®é¢˜
> æ¯æ¬¡å›ç­”åŒºé—´å†…å…ƒç´ `val * cnt[val]`çš„æœ€å¤§å€¼ã€‚
> `n` `m` èŒƒå›´éƒ½åˆ° `1E5`

```cpp
const int N = 1e5 + 100;
int n,m;
int len;
int w[N],cnt[N];
int ans[N];

struct Query
{
    int id, l, r;
} q[N];

vector<int> nums;

int get(int x)
{
    return x/len;
}

bool cmp(const Query& a,const Query& b)
{
    if(get(a.l) == get(b.l)) return a.r < b.r;

    return get(a.l) < get(b.l);
}

void add(int x,int& res)
{
    cnt[x] ++;
    res = max(res,cnt[x] * nums[x]);
}

void solve()
{
    cin >> n >> m;
    len = sqrt(n);
    rep(i,1,n) cin >> w[i],nums.pb(w[i]);
    sort(nums.begin(),nums.end());
    nums.erase(unique(nums.begin(),nums.end()),nums.end());
    rep(i,1,n) 
    w[i] = lower_bound(nums.begin(),nums.end(),w[i]) - nums.begin();

    for(int i = 0;i < m;i ++){
        int l,r; cin >> l >> r;
        q[i] = {i, l, r};
    }

    sort(q,q + m,cmp);

    for(int x = 0;x < m; )
    {
        int y = x;
        while(y < m && get(q[y].l) == get(q[x].l)) y++;   // ç¡®å®šå·¦è¾¹ç•Œåœ¨åŒä¸€å—çš„è¯¢é—®
        
        int right = get(q[x].l) * len + len - 1;          // ç¡®å®šå·¦è¾¹ç•Œå—çš„å³ç«¯ç‚¹

        while(x < y && q[x].r <= right)                   // æš´åŠ›å¤„ç†åŒä¸€å—çš„è¯¢é—®
        {
            int res = 0;
            rep(k,q[x].l,q[x].r) add(w[k],res);
            ans[q[x].id] = res;
            rep(k,q[x].l,q[x].r) cnt[w[k]] --;
            x ++;
        }

        int res = 0;
        int i = right; int j = right + 1;                 // å¤„ç†å·¦å³ç«¯ç‚¹ä¸åœ¨åŒä¸€å—çš„è¯¢é—®
        while(x < y)
        {
            while(i < q[x].r) add(w[++ i], res);          // å¤„ç†å³ç«¯ç‚¹æ‰€åœ¨éƒ¨åˆ†
            int backup = res;                             // å¤‡ä»½åªæœ‰å³ç«¯ç‚¹éƒ¨åˆ†ç­”æ¡ˆ
            while(j > q[x].l) add(w[-- j],res);           // å¤„ç†å·¦åŠéƒ¨åˆ†
            ans[q[x].id] = res;                           // è®°å½•ç­”æ¡ˆ
            while(j < right + 1) cnt[w[j ++]] --;         // å›æº¯æ•°é‡
            res = backup;                                 // å›æº¯å³ç«¯ç‚¹ç­”æ¡ˆ
            x ++;
        }                                                 // ç›¸å½“äºæ¯æ¬¡åªè®°å½•å³ç«¯ç‚¹çš„å½±å“
        memset(cnt, 0,sizeof cnt);                        // æ¶‰åŠå·¦ç«¯ç‚¹æ—¶é‡ç®—

    }

    for(int i = 0;i < m;i ++) cout << ans[i] << endl;
}

```

å­¦ä¹ å‚è€ƒ:[å¤§ä½¬çš„èµ„æ–™](https://www.cnblogs.com/Parsnip/p/10969989.html#)

